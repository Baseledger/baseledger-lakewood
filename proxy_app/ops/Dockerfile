FROM golang:1.16-alpine

WORKDIR /apps

ARG DB_HOST
ARG ORGANIZATION_ID
ARG API_CONCIRCLE_URL

COPY go.mod .
COPY go.sum .
RUN go mod download

COPY . .

EXPOSE 8080

ENV DB_HOST=$DB_HOST
ENV DB_UB_USER=<user>
ENV DB_UB_PWD=<pass>
ENV DB_UB_NAME=ub
ENV DB_SSLMODE=disable
ENV DB_BASELEDGER_NAME=baseledger
ENV DB_BASELEDGER_USER=baseledger
ENV NATS_URL=nats:4222
ENV BLOCKCHAIN_APP_URL=blockchain_app:1317
ENV TENDERMINT_API_URL=blockchain_app:26657
ENV ORGANIZATION_ID=$ORGANIZATION_ID
ENV API_UB_USER=<user>
ENV API_UB_PWD=<pass>
ENV API_CONCIRCLE_USER=<user>
ENV API_CONCIRCLE_PWD=<pass>
ENV API_CONCIRCLE_URL=$API_CONCIRCLE_URL

RUN go build -o /proxy_app httpd/main.go

CMD ["/proxy_app"]